#!/bin/bash

# $OMA_PATH points to the folder containing the current
# version of OMA.
OMA_PATH=$(dirname $0)/..

pfile="parameters.drw"
wdir="./"
paramerror="

I found an error in your parameter file.
Most probably, you missed a semicolon at the end of a line.

Please fix it and try again."

if [ $# -gt 0 ]
then
    if [ $1 = "--help" -o $1 = "-h" -o $1 = "-?" ]
    then
        echo "Usage: OMA [<parameter file>]"
        exit 0;
    fi
    if [ $1 = "--version" -o $1 = "-v" ]
    then
        echo "OMA version [VERSIONNR]"
        exit 0;
    fi
fi

if [ $# -eq 1 ]
then
    pfile=$1
elif [ $# -gt 1 ]
then
    echo "Too many parameters!"
    exit 1
fi

if [ ! -e $pfile ]
then
    echo "Could not find parameter file!"
    exit 1
fi

cat $OMA_PATH/lib/splashscreen.txt
echo "libdir := '$OMA_PATH/lib/': \
e := traperror(eval(parse(ReadRawFile('$pfile')))): \
if e=lasterror then print('$paramerror'): done: fi: \
OMA_STANDALONE_VERSION := '[VERSIONNR]': \
ReadProgram('$OMA_PATH/OMA.drw'): done:" | $OMA_PATH/bin/omadarwin -q 

